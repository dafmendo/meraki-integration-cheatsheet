= Edge branches WiFi automation with AAP and SD-WAN Meraki Cheat Sheet
:experimental: true
:product-name:

This cheat sheet covers the commands used for working with https://meraki.cisco.com[Cisco Meraki], one of the Cisco enterprise cloud managed networking solutions, a popular solution for managing access points, security appliances, L2 and L3 switches, and more. This cheatsheet will show how to use Automated NetOps through a GitHub integration with Ansible Automation Platform to manage the Meraki controlled devices configuration as code.

The steps configured here can be recreated using Cisco Devnet Sandbox Lab https://devnetsandbox.cisco.com/RM/Diagram/Index/aa48e6e2-3e59-4b87-bfe5-7833c45f8db8?diagramType=Topology[Meraki Small Business], which allows an 8 hr reservation by default, and after the reservation is ready it will allow you to get admin access to configure Wireless and networking for your specific settings.

The overall use case will follow this flow: 
----
1. Cisco DevNet sandbox reservation if you do not have your own Meraki environment to configure (optional)
2. Cisco Meraki dashboard API Key generation to allow the provisioning from Ansible Automation Platform
3. Configure GitHub Repo with the wireless settings
4. Configure the Ansible Automation Platform project and template
5. GitHub and Ansible Automation Platform integration
6. Edit the wireless settings to observe an automatic trigger of the automation job
----

The Configuration flow will go like this:

GitHub Repo (through webhook) -> Ansible Automation Platform -> Meraki Dashboard Controller API -> Networking device (Access Point)

== Note

The `$` symbol that proceeds commands in the examples represents the command line prompt.

== Cisco DevNet sandbox reservation (optional)
For this cheatsheet we will use https://devnetsandbox.cisco.com/RM/Diagram/Index/aa48e6e2-3e59-4b87-bfe5-7833c45f8db8?diagramType=Topology[Meraki Small Business] as it will allow some specific provisioning tasks.

image:https://github.com/dafmendo/meraki-integration-cheatsheet/blob/a5a1d5004397b7401af2465c1d7a4cad9f4a4cb8/images/meraki-images/sandox-reserve.png[Cisco Meraki Sandox Reservation from DevNet]

Once you login with your Cisco DevNet credentials, I am using my personal Google account for this setup, you click on `Reserve` button and after you reconfirm the reservation, a Setup job will be triggered. 

image:https://github.com/dafmendo/meraki-integration-cheatsheet/blob/a5a1d5004397b7401af2465c1d7a4cad9f4a4cb8/images/meraki-images/sandox-merakismallbusiness.png[Cisco Meraki Small Business Sandox Reservation from DevNet]

Wait around 5 minutes to get a confirmation mail with the credentials you will use to login into the https://n149.meraki.com[Cisco Meraki dashboard], you might get the username and will be asked to reset your password.



When you connect into https://n149.meraki.com[Cisco Meraki dashboard] a anonymized network will be created with your mail, in my case the network name is: `DNSMB4-dxxxxxlgmail.com`

==== Note

The network generated automatically with your mail account as an input is the network that will give you writing access. Use that specific network for all this demo, and do not use a different one.


== Cisco Meraki dashboard steps

=== Organization - Monitor - Summary - Networks

Shows all `Organization`, select `Summary` and scroll down to `Networks` to view all Networks available for your `Organization`.
Shows all Organization `Networks`, click on your assigned `Network` to view the settings.

*Example:*

The following image shows the Networks filtered: 

image:https://github.com/dafmendo/meraki-integration-cheatsheet/blob/d72a63f0efc695f21e21631fdb84700ea9d8dfcd/images/meraki-images/Organization-Networks.png[Networks available]

And once you select your network, you will have access to specific sections:
image:https://github.com/dafmendo/meraki-integration-cheatsheet/blob/0bb217483043a89015dd3d72a6dcfdc261e1bdb2/images/meraki-images/network-selected.png[Network]

=== Organization - Configure - Settings

Allows you to edit configurations for the `Organization`, which by default will be named "DevNet Sandbox". Almost at the end of this page, you can find `Dashboard API access`. 

*Example:*

The following image shows the Organization configuration settings available: 
image:https://github.com/dafmendo/meraki-integration-cheatsheet/blob/9cdae8d424baa08453fb2154483b678f2ca80b7c/images/meraki-images/organization-settings.png[Organization configuration settings]


=== Organization - Configure - Dashboard API access

Will show you two options: `Enable access to the Cisco Meraki Dashboard API` and if you click on the hyperlink `Profile` you can generate an API key to allows the configuration from Ansible Automation Platform.

image:https://github.com/dafmendo/meraki-integration-cheatsheet/blob/0c96d9f67598b455e545673cc6644478537a7ee6/images/meraki-images/organization-dashboardapiaccess.png[Dashboard API access]

=== User profile - API access

You can reach this configuration settings with two options: 

1. Clicking the hyperlink `Profile` from `Organization - Configure - Dashboard API access` and going to `API access`.
2. Selecting from the top right corner the User icon and clicking on it to select `My profile`and later `API access`.

Once there click on `Generate new API key`. 
image:https://github.com/dafmendo/meraki-integration-cheatsheet/blob/0c96d9f67598b455e545673cc6644478537a7ee6/images/meraki-images/api-access-key-generation.png[Generate new API key]

==== Note

Make sure you save the API key as it will be available for copy only once. When you finish click on `Done`button. 

=== User profile - API access - API keys

Once you generate at least one API key, you can generate additional ones, or `Revoke`specific API keys. As a general practice make sure to revoke API keys if you are not using them.
image:https://github.com/dafmendo/meraki-integration-cheatsheet/blob/0c96d9f67598b455e545673cc6644478537a7ee6/images/meraki-images/api-keys.png[API keys]

=== Wireless - Configure - SSIDs

You can see that as part of the Sandbox enablement you will have SSID 1 configured, in my environment I have one SSID named: "DNSMB2 - wireless WiFi", you can manually disable the network, rename it, and also edit Access control configuration.
After every change make sure to click on `Save Changes` button or `cancel`. 


== Configure GitHub Repo with the wireless settings

Login to https://github.com/[GitHub] with your credentials. 
We are using this GitHub Repo as reference: https://github.com/pseguel-redhat/gitops_test.git[gitOps_test] you can Fork it to replicate this integration.

In my example I alreayd forked the source https://github.com/dafmendo/gitops_test.git[here] and made few editions mostly on translation.
Make sure after you fork to edit the `network_vars.yml` with the following settings:
---
Org_Name: DevNet Sandbox
Net_Name: Your assigned Network Name from Meraki dashboard
---

In my example this would be:
----
Org_Name: DevNet Sandbox
Net_Name: DNSMB2-dxxxxxxxlgmail.com
----

You should also edit the SSIDs in `network_vars.yml` for my example I will edit SSID 2 and SSID 4 and the playbook will look like this:
----
---
Org_Name: DevNet Sandbox
Net_Name: DNSMB2-dxxxxxxxlgmail.com
SSID:
  - name: MyCompany_customers
    number: 2
    enabled: no
    auth_mode: psk
    encryption_mode: wpa
    psk: yourcustomerwifipass
  - name: MyCompany_employees
    number: 3
    enabled: yes
    auth_mode: psk
    encryption_mode: wpa
    psk: youremployeeswifipass
----

== Configure the Ansible Automation Platform project and template



== GitHub and Ansible Automation Platform integration

=== GitHub Repo - Settings

Will allow you to edit the repo General settings, Access, Code and Automation, Security, Integrations configuration. 

=== GitHub Repo - Settings - Code and Automation - Webhooks
Webhooks allow external services to be notified when certain events happen. One example would be a configuration change, a push event, that can trigger an automation job using Ansible Automation Platform usending a POST request.
To enable the Webhook click on `Add webhook` button.

==== Note
Depending on your security settings, the Webhook addition might require 2-step approvals.






